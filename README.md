# Python-C++ 跨语言聊天系统

一个支持 **Python 和 C++ 跨语言通信** 的完整聊天系统，实现了文本聊天、文件传输和用户管理功能。

## 🌟 核心特性

- ✅ **跨语言兼容** - Python 和 C++ 版本完全互通
- ✅ **多客户端支持** - 服务器可同时处理多个客户端连接
- ✅ **实时聊天** - 支持文本消息实时收发
- ✅ **文件传输** - 支持文件上传下载，带进度显示
- ✅ **私信功能** - 支持 @用户名 格式的私信
- ✅ **服务器管理** - 丰富的服务器端管理命令
- ✅ **无外部依赖** - 无需第三方库

## � 文件结构

```
my_web/
├── server.py                       # Python 服务器（推荐）
├── client.py                       # Python 客户端
├── utils.py                        # Python 工具函数库
├── cpp_server_compatible.cpp       # C++ 兼容服务器
├── cpp_client_compatible.cpp       # C++ 兼容客户端
├── server                          # 编译后的C++服务器
├── client                          # 编译后的C++客户端
├── files/                          # 文件传输目录
│   ├── downloads/                  # 客户端下载文件存放目录
│   ├── received/                   # 服务器接收文件存放目录
│   └── server/                     # 服务器发送文件存放目录
└── README.md                       # 说明文档
```

## 🚀 快速开始

### 编译C++版本
```bash
# 编译C++服务器
g++ -std=c++11 -pthread -o cpp_server_compatible cpp_server_compatible.cpp

# 编译C++客户端  
g++ -std=c++11 -pthread -o cpp_client_compatible cpp_client_compatible.cpp
```

### 启动服务器（任选其一）

**Python 服务器：**
```bash
python3 server.py
```

**C++ 服务器：**
```bash
./cpp_server_compatible
```

### 连接客户端

**Python 客户端：**
```bash
python3 client.py
```

**C++ 客户端：**
```bash
./cpp_client_compatible
```

## 🔗 跨语言兼容性

以下所有组合都完全兼容：

1. **Python服务器 + Python客户端** ✅
2. **Python服务器 + C++客户端** ✅  
3. **C++服务器 + Python客户端** ✅
4. **C++服务器 + C++客户端** ✅

## 📋 使用说明

### 服务器管理命令

在服务器控制台输入：

- `/msg <消息内容>` - 向所有客户端广播消息
- `/msg @用户名 <消息内容>` - 向指定用户发送私信
- `/send <文件路径>` - 向所有客户端广播文件
- `/send @用户名 <文件路径>` - 向指定用户发送文件
- `/list` - 显示在线用户列表
- `/help` - 显示帮助信息
- `/quit` - 关闭服务器

### 客户端命令

在客户端输入：

- 直接输入文本 - 发送聊天消息
- `/send <文件路径>` - 发送文件给所有用户
- `/help` - 显示帮助信息
- `/quit` - 退出聊天室

### 私信格式

```
@用户名 你的消息内容
```

## 🔧 技术特性

### 消息协议
- **格式**: JSON消息 + 4字节长度前缀
- **编码**: UTF-8
- **字节序**: 网络字节序（大端）

### 文件传输
- **分块传输**: 8KB 缓冲区
- **编码方式**: 十六进制编码确保安全传输
- **进度显示**: 实时显示传输进度和速度
- **支持格式**: 支持所有文件类型

### 并发处理
- **多线程**: 每个客户端独立线程处理
- **线程安全**: 使用互斥锁保护共享资源
- **异步IO**: 非阻塞消息处理

### 文件传输标准
- **分块大小**: 8KB (8192字节) 统一缓冲区
- **传输编码**: 十六进制字符串，确保二进制文件安全传输
- **客户端接收**: 保存到 `files/downloads/`，重名时添加数字后缀
- **服务器接收**: 保存到 `files/received/`，使用 `{用户名}_{文件名}` 格式
- **服务器发送**: 建议放在 `files/server/` 目录（可使用任意路径）

## 🛠 开发说明

### Python 版本特点
- 功能完整，代码简洁
- 丰富的错误处理和日志
- 适合快速开发和原型验证

### C++ 版本特点
- 高性能，低资源占用
- 完全兼容Python协议
- 适合生产环境部署

### 协议兼容性
- 统一的JSON消息格式
- 相同的网络字节序处理
- 一致的错误处理机制

## 📝 示例使用

1. **启动Python服务器**
   ```bash
   python3 server.py
   ```

2. **连接C++客户端**
   ```bash
   ./cpp_client_compatible
   ```

3. **发送消息**
   ```
   你好，这是跨语言通信测试！
   ```

4. **发送文件**
   ```
   /send example.txt
   ```

5. **发送私信**
   ```
   @用户名 这是私信内容
   ```

## 🎯 适用场景

- 学习网络编程和跨语言通信
- 构建分布式聊天系统
- 文件传输和同步工具
- 多语言项目的通信组件
- 实时协作应用开发

---

**项目状态**: ✅ 完整功能，生产就绪
**支持平台**: Linux, macOS, Windows
**编程语言**: Python 3.x, C++ 11+

## 🔗 协议兼容性

### 统一JSON协议（Python + C++兼容版）
```json
{
    "type": "TEXT|FILE|FILE_DATA|FILE_COMPLETE|USER_JOIN|USER_LEAVE",
    "data": "消息内容或数据",
    "metadata": {
        "filename": "文件名",
        "size": "文件大小", 
        "sender": "发送者"
    }
}
```

### 传输格式
- **长度前缀**: 4字节网络字节序
- **消息体**: UTF-8编码的JSON字符串  
- **文件数据**: 十六进制字符串编码

## 示例会话

**服务器端：**
```
$ ./simple_server
服务器启动成功，监听 127.0.0.1:8888
命令: /quit (退出), /list (用户列表), /msg <消息> (广播)
用户 'Alice' 加入聊天室
用户 'Bob' 加入聊天室
[Alice]: 大家好！
[Bob]: @Alice 你好！
```

**客户端端：**
```
$ ./simple_client
=== 简易聊天客户端 ===
服务器地址 [127.0.0.1]: 
端口 [8888]: 
用户名: Alice
成功连接到服务器

聊天室客户端启动成功!
命令: /file <路径> (发送文件), /list (用户列表), /quit (退出)
私信: @用户名 消息内容
>>> 大家好！
用户 'Bob' 加入了聊天室
Bob: @Alice 你好！
>>> 
```

## 📊 版本对比

| 特性 | Python 版本 | C++ 兼容版 | C++ 简化版 |
|------|-------------|-----------|------------|
| 跨语言兼容 | ✅ 标准 | ✅ 完全兼容 | ❌ 不兼容 |
| 性能 | 中等 | 高 | 最高 |
| 内存占用 | ~10MB | ~2MB | ~1MB |
| 并发连接 | 100+ | 1000+ | 2000+ |
| 开发便利 | 最高 | 高 | 中等 |
| 外部依赖 | 无 | 无 | 无 |

## 🎯 使用场景

### Python 版本
- 快速原型开发
- 功能验证和测试
- 学习网络编程概念

### C++ 兼容版本  
- **跨语言项目集成**
- **生产环境部署**
- **高并发聊天系统**
- **Python-C++混合开发**

### C++ 简化版本
- 纯C++环境
- 极致性能要求
- 嵌入式系统

## 🧪 测试验证

```bash
# 运行兼容性测试
./test_compatibility.sh

# 运行跨语言演示  
./demo_cross_language.sh

# 快速功能验证
make test-python-server-cpp-client
make test-cpp-server-python-client
```

## 🔧 故障排除

### 编译问题
- 确保使用支持 C++17 的编译器
- 检查系统是否支持 pthread

### 连接问题  
- 检查防火墙设置和端口占用
- 验证IP地址和端口配置

### 跨语言兼容问题
- 确保使用兼容版本的C++程序
- 检查JSON消息格式是否正确

## 📚 进一步了解

- 查看 [CROSS_LANGUAGE_COMPATIBILITY.md](CROSS_LANGUAGE_COMPATIBILITY.md) 了解详细的跨语言兼容性实现
- 研究 `cpp_*_compatible.cpp` 文件了解C++的JSON协议实现
- 参考 `utils.py` 了解Python的消息协议处理

## 🎉 项目亮点

这个项目成功实现了：
- **零外部依赖的跨语言兼容性**
- **完整的聊天系统功能集**  
- **高性能的C++实现**
- **易于扩展的模块化设计**

无论你是Python开发者还是C++开发者，都可以选择适合的版本，并且能够与使用其他语言的开发者无缝协作！
